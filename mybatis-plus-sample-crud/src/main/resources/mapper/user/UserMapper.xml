<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.baomidou.mybatisplus.samples.crud.mapper.UserMapper">
    <sql id="Base_Column_List">
        id,
        `name`,
        age,
        email
    </sql>
    <resultMap id="BaseResultMap" type="com.baomidou.mybatisplus.samples.crud.entity.User">
        <!--@Table `user`-->
        <result column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="age" property="age"/>
        <result column="email" property="email"/>
        <!--        <result column="ignore_column" property="ignoreColumn"/>-->
        <!--        <result column="count" property="count"/>-->
    </resultMap>

    <!--auto generated by MybatisCodeHelper on 2021-01-15-->
    <select id="selectOneById" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from user
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
        </where>
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-01-15-->
    <select id="selectByNameLike" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from user
        <where>
            <if test="likeName != null">
                and `name` like concat('%', #{likeName}, '%')
            </if>
        </where>
    </select>


    <resultMap id="userRoleVoResultMap" type="com.baomidou.mybatisplus.samples.crud.vo.UserRoleVo">
        <result column="id" property="id"/>
        <result column="name" property="name"/>
        <result column="age" property="age"/>
        <result column="email" property="email"/>
        <collection property="roles" ofType="com.baomidou.mybatisplus.samples.crud.entity.Role" javaType="list">
            <id column="role_id" property="id"/>
            <result column="role_name" property="name"/>
        </collection>
    </resultMap>
    <select id="selectAllWithRoleById" resultMap="userRoleVoResultMap">
        select t1.id, t1.name, t1.age, t1.email, t3.id as role_id, t3.name as role_name
        from user t1
                     join user_role t2 on t1.id = t2.user_id
                     join role t3 on t3.id = t2.role_id
        where t1.id = #{id}
    </select>

    <!--auto generated by MybatisCodeHelper on 2021-02-05-->
    <select id="selectAllOrderByName" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from `user`
        order by convert(trim(`name`) using gbk) collate gbk_chinese_ci asc
    </select>
</mapper>